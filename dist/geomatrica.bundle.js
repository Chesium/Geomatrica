(()=>{"use strict";class t{constructor(t,s,i,e,a){this.obj=a,this.define(t,s,i,e)}init(t){this.calcData(),!0===this.cache.following&&(this.cache.following=!1)}define(t,s,i,e){this.type=t,this.dfnType=s,this.dfn={...i},this.data={exist:!1},this.cache={},this.parents=[],null==this.children&&(this.children=[]),this.seqI=0,this.initializing=!1,this.init(e)}calcData(){}beginDraw(t){}beginDrag(t){}beginMove(t){}updDrag(t){}updMove(t){}preDefine(){}generateRefCrd(){if(!this.data.exist)return{x:void 0,y:void 0}}focusOnIt(){this.obj.canvas.F=this.obj.index,this.obj.canvas.Status=1}checkHiddenParents(){for(var t in this.parents)if(!this.parents[t].data.exist)return this.data.exist=!1,!0;return!1}}class s extends t{constructor(t,s,i){super(0,0,t,s,i)}init(t){this.seqI=0,this.data.exist=!0,this.data.x=t.pos.x,this.data.y=t.pos.y}beginDrag(t){this.beginMove(t)}beginMove(t){this.focusOnIt(),this.dragOffset={x:this.data.x-t.x,y:this.data.y-t.y}}updDrag(t){this.updMove(t)}updMove(t){this.data.x=t.x+this.dragOffset.x,this.data.y=t.y+this.dragOffset.y,this.obj.update()}generateRefCrd(){return this.data}}class i extends t{constructor(t,s,i){super(0,1,t,s,i)}init(t){this.seqI=0,this.dfn.l.children.push(this),this.parents=[this.dfn.l],this.cache.proportion=.5,this.cache.following=!0,this.data.x=t.pos.x,this.data.y=t.pos.y,this.calcData(),this.cache.following=!1}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.l.data.a,s=this.dfn.l.data.b,i=this.dfn.l.data.c,e=this.dfn.l.data.d,a=this.dfn.l.data.r,h=this.dfn.l.cache.p[0],n=this.dfn.l.cache.p[1];if(!this.cache.following){var o=(n-h)*this.cache.proportion+h;return this.data.exist=!0,this.data.x=t*o+s,void(this.data.y=i*o+e)}0!=i||0!=t?(o=(t*(this.data.x-s)+i*(this.data.y-e))/(t*t+i*i))<Math.min(a[0],a[1])?(this.data.exist=!0,this.data.x=t*h+s,this.data.y=i*h+e,this.cache.proportion=0):o>Math.max(a[0],a[1])?(this.data.exist=!0,this.data.x=t*n+s,this.data.y=i*n+e,this.cache.proportion=1):(this.data.exist=!0,this.data.x=t*o+s,this.data.y=i*o+e,this.cache.proportion=(o-h)/(n-h)):console.log("ERROR in calcData:the line doesn't exist.")}}beginDrag(t){this.focusOnIt()}beginMove(t){this.dfn.l.beginDrag(t)}updDrag(t){this.data.x=t.x,this.data.y=t.y,this.cache.following=!0,this.obj.update(),this.cache.following=!1}updMove(t){this.dfn.l.updMove(t)}generateRefCrd(){return this.data}}class e extends t{constructor(t,s,i){super(0,2,t,s,i)}init(t){this.seqI=0,this.dfn.c.children.push(this),this.parents=[this.dfn.c],this.cache.cosine=0,this.cache.sine=0,this.cache.following=!0,this.data.x=t.pos.x,this.data.y=t.pos.y,this.calcData(),this.cache.following=!1}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.c.data.x,s=this.dfn.c.data.y,i=this.dfn.c.data.r;if(this.cache.following){var e=this.data.x-t,a=this.data.y-s,h=Math.sqrt(e*e+a*a);this.cache.cosine=e/h,this.cache.sine=a/h}this.data.exist=!0,this.data.x=t+i*this.cache.cosine,this.data.y=s+i*this.cache.sine}}beginDrag(t){this.focusOnIt()}beginMove(t){this.dfn.c.beginDrag(t)}updDrag(t){this.data.x=t.x,this.data.y=t.y,this.cache.following=!0,this.obj.update(),this.cache.following=!1}updMove(t){this.dfn.c.updMove(t)}generateRefCrd(){return this.data}}class a extends t{constructor(t,s,i){super(0,3,t,s,i)}init(t){this.seqI=0,this.dfn.l[0].children.push(this),this.dfn.l[1].children.push(this),this.parents=[this.dfn.l[0],this.dfn.l[1]]}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.l[0].data.a,s=this.dfn.l[0].data.b,i=this.dfn.l[0].data.c,e=this.dfn.l[0].data.d,a=this.dfn.l[0].data.r,h=this.dfn.l[1].data.a,n=this.dfn.l[1].data.b,o=this.dfn.l[1].data.c,r=this.dfn.l[1].data.d,d=this.dfn.l[1].data.r;if(t*o!=h*i){var c=(n*o-s*o+h*e-h*r)/(t*o-h*i),p=(n*i-s*i+t*e-t*r)/(t*o-h*i);c<Math.min(a[0],a[1])||c>Math.max(a[0],a[1])||p<Math.min(d[0],d[1])||p>Math.max(d[0],d[1])?this.data.exist=!1:(this.data.exist=!0,this.data.x=t*c+s,this.data.y=i*c+e)}else this.data.exist=!1}}beginDrag(t){this.beginMove(t)}beginMove(t){this.dfn.l[0].beginMove(t),this.dfn.l[1].beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.l[0].updMove(t),this.dfn.l[1].updMove(t)}generateRefCrd(){return this.data}}class h extends t{constructor(t,s,i){super(0,4,t,s,i)}init(t){this.seqI=0,this.dfn.c[0].children.push(this),this.dfn.c[1].children.push(this),this.parents=[this.dfn.c[0],this.dfn.c[1]]}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.c[0].data.x,s=this.dfn.c[0].data.y,i=this.dfn.c[0].data.r,e=this.dfn.c[1].data.x,a=this.dfn.c[1].data.y,h=this.dfn.c[1].data.r,n=(t-e)*(t-e)+(s-a)*(s-a),o=Math.sqrt(n);if(o>i+h)this.data.exist=!1;else{var r=(i*i-h*h)/(2*n)+.5,d=o*r,c=t+r*(e-t),p=s+r*(a-s),l=Math.sqrt(i*i-d*d)/d;this.data.exist=!0,this.data.x=c+l*(s-p),this.data.y=p-l*(t-c)}}}beginDrag(t){this.beginMove(t)}beginMove(t){this.dfn.c[0].beginMove(t),this.dfn.c[1].beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.c[0].updMove(t),this.dfn.c[1].updMove(t)}generateRefCrd(){return this.data}}class n extends t{constructor(t,s,i){super(0,5,t,s,i)}init(t){this.seqI=0,this.dfn.c[0].children.push(this),this.dfn.c[1].children.push(this),this.parents=[this.dfn.c[0],this.dfn.c[1]]}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.c[0].data.x,s=this.dfn.c[0].data.y,i=this.dfn.c[0].data.r,e=this.dfn.c[1].data.x,a=this.dfn.c[1].data.y,h=this.dfn.c[1].data.r,n=(t-e)*(t-e)+(s-a)*(s-a),o=Math.sqrt(n);if(o>i+h)this.data.exist=!1;else{var r=(i*i-h*h)/(2*n)+.5,d=o*r,c=t+r*(e-t),p=s+r*(a-s),l=Math.sqrt(i*i-d*d)/d;this.data.exist=!0,this.data.x=c-l*(s-p),this.data.y=p+l*(t-c)}}}beginDrag(t){this.beginMove(t)}beginMove(t){this.dfn.c[0].beginMove(t),this.dfn.c[1].beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.c[0].updMove(t),this.dfn.c[1].updMove(t)}generateRefCrd(){return this.data}}class o extends t{constructor(t,s,i){super(0,6,t,s,i)}init(t){this.seqI=0,this.dfn.l.children.push(this),this.dfn.c.children.push(this),this.parents=[this.dfn.l,this.dfn.c]}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.l.data.a,s=this.dfn.l.data.b,i=this.dfn.l.data.c,e=this.dfn.l.data.d,a=this.dfn.l.data.r,h=this.dfn.c.data.x,n=this.dfn.c.data.y,o=this.dfn.c.data.r,r=t*t+i*i,d=2*(t*(s-h)+i*(e-n)),c=d*d-4*r*(s*s+e*e+h*h+n*n-o*o-2*(s*h+e*n));if(c<0)this.data.exist=!1;else{var p,l=(-d+Math.sqrt(c))/(2*r),b=-(d/r+l),g=[];l>=Math.min(a[0],a[1])&&l<=Math.max(a[0],a[1])&&g.push(l),b>=Math.min(a[0],a[1])&&b<=Math.max(a[0],a[1])&&g.push(b),0!=g.length?(p=1==this.dfn.l.data.dr?Math.max(...g):Math.min(...g),this.data.exist=!0,this.data.x=t*p+s,this.data.y=i*p+e):this.data.exist=!1}}}beginDrag(t){this.beginMove(t)}beginMove(t){this.dfn.l.beginMove(t),this.dfn.c.beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.l.updMove(t),this.dfn.c.updMove(t)}generateRefCrd(){return this.data}}class r extends t{constructor(t,s,i){super(0,7,t,s,i)}init(t){this.seqI=0,this.dfn.l.children.push(this),this.dfn.c.children.push(this),this.parents=[this.dfn.l,this.dfn.c]}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.l.data.a,s=this.dfn.l.data.b,i=this.dfn.l.data.c,e=this.dfn.l.data.d,a=this.dfn.l.data.r,h=this.dfn.c.data.x,n=this.dfn.c.data.y,o=this.dfn.c.data.r,r=t*t+i*i,d=2*(t*(s-h)+i*(e-n)),c=d*d-4*r*(s*s+e*e+h*h+n*n-o*o-2*(s*h+e*n));if(c<0)this.data.exist=!1;else{var p,l=(-d+Math.sqrt(c))/(2*r),b=-(d/r+l),g=[];l>=Math.min(a[0],a[1])&&l<=Math.max(a[0],a[1])&&g.push(l),b>=Math.min(a[0],a[1])&&b<=Math.max(a[0],a[1])&&g.push(b),2==g.length?(p=-1==this.dfn.l.data.dr?Math.max(...g):Math.min(...g),this.data.exist=!0,this.data.x=t*p+s,this.data.y=i*p+e):this.data.exist=!1}}}beginDrag(t){this.beginMove(t)}beginMove(t){this.dfn.l.beginMove(t),this.dfn.c.beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.l.updMove(t),this.dfn.c.updMove(t)}generateRefCrd(){return this.data}}function d(t,s){var i=s[0][0],e=s[0][1],a=s[1][0],h=s[1][1];if(0==t.a){if(0==t.c)return void console.log("ERROR in L_DpData_To_epCrd: the line doesn't exist.");if(t.b<i||t.b>a)return[!1,[0,0],[0,0]];var n=(h-t.d)/t.c,o=(e-t.d)/t.c,r=Math.max(Math.min(t.r[0],t.r[1]),Math.min(n,o)),d=Math.min(Math.max(t.r[0],t.r[1]),Math.max(n,o))}else if(0==t.c){if(t.d<h||t.d>e)return[!1,[0,0],[0,0]];n=(i-t.b)/t.a,o=(a-t.b)/t.a,r=Math.max(Math.min(t.r[0],t.r[1]),Math.min(n,o)),d=Math.min(Math.max(t.r[0],t.r[1]),Math.max(n,o))}else{var c=(h-t.d)/t.c,p=(e-t.d)/t.c,l=(i-t.b)/t.a,b=(a-t.b)/t.a,g=c*t.a+t.b,f=p*t.a+t.b,v=Math.min(g,f),u=Math.max(g,f);if(v<i&&u<i||v>a&&u>a)return[!1,[0,0],[0,0]];var y=v>i?g<f?c:p:l,m=u<a?g>f?c:p:b;r=Math.max(Math.min(t.r[0],t.r[1]),Math.min(y,m)),d=Math.min(Math.max(t.r[0],t.r[1]),Math.max(y,m))}return[!0,[t.a*r+t.b,t.c*r+t.d],[t.a*d+t.b,t.c*d+t.d]]}function c(t,s){for(let i=0;i<s.length;i++)for(let e=0;e<t.length;e++)if(t[e].obj.index==s[i].obj.index)return!0;return!1}function p(t){for(var s=t.offsetLeft,i=t.offsetParent;null!=i;)s+=i.offsetLeft,i=i.offsetParent;return s}function l(t){for(var s=t.offsetTop,i=t.offsetParent;null!=i;)s+=i.offsetTop,i=i.offsetParent;return s}function b(t,s){var i,e,a;try{i=t.toString().split(".")[1].length}catch(t){i=0}try{e=s.toString().split(".")[1].length}catch(t){e=0}return(g(t,a=Math.pow(10,Math.max(i,e)))+g(s,a))/a}function g(t,s){var i=0,e=t.toString(),a=s.toString();try{i+=e.split(".")[1].length}catch(t){}try{i+=a.split(".")[1].length}catch(t){}return Number(e.replace(".",""))*Number(a.replace(".",""))/Math.pow(10,i)}class f{IAApAlpha=.002;IAApColor=16777215;IAApRadius=15;IAAl={width:15,color:16777215,alpha:.002};constructor(t,s,i){this.type=t,this.data=s,this.obj=i,this.Graphic=new PIXI.Graphics,this.boundBox=new PIXI.Graphics,this.bound=[[0,0],[0,0]],this.bitmap=[],this.needUpdBound=!1,this.needUpdBitmap=!1,this.locked=!1,this.removed=!1,this.Graphic.zIndex=0,this.boundBox.zIndex=2,this.obj.canvas.stage.addChild(this.Graphic),this.obj.canvas.stage.addChild(this.boundBox),this.update()}update(){if(!this.removed){if(this.Graphic.clear(),this.data.exist)switch(this.type){case 0:this.Graphic.beginFill(this.IAApColor,this.IAApAlpha),this.Graphic.drawCircle(...this.obj.canvas.tran(this.data),this.IAApRadius);break;case 1:var t=d(this.data,[this.obj.canvas.revTran(this.obj.canvas.stageBound[0]),this.obj.canvas.revTran(this.obj.canvas.stageBound[1])]);if(!t[0])return;this.Graphic.lineStyle(this.IAAl),this.Graphic.moveTo(...this.obj.canvas.tran(t[1])),this.Graphic.lineTo(...this.obj.canvas.tran(t[2]));break;case 2:this.Graphic.lineStyle(this.IAAl),this.Graphic.drawCircle(...this.obj.canvas.tran(this.data),this.data.r*this.obj.canvas.tr[0])}this.needUpdBitmap=!0,this.needUpdBound=!0}}updBound(){let t=this.Graphic.getLocalBounds();this.bound=[[Math.floor(t.x),Math.floor(t.y)],[Math.floor(t.x+this.Graphic.width),Math.floor(t.y+this.Graphic.height)]],this.boundBox.clear(),this.obj.canvas.showBoundBox&&(this.boundBox.lineStyle({width:1,color:0,cap:PIXI.LINE_CAP.ROUND}),this.boundBox.beginFill(0,.1),this.boundBox.drawRect(this.bound[0][0],this.bound[0][1],this.bound[1][0]-this.bound[0][0],this.bound[1][1]-this.bound[0][1])),this.needUpdBound=!1}updBitmap(){let t=this.obj.canvas.PIXIapp.renderer.plugins.extract.pixels(this.Graphic),s=Array.from({length:t.length/4},((s,i)=>t[4*i+3]+t[4*i+2]+t[4*i+1]+t[4*i])),i=Math.floor(this.Graphic.width);this.bitmap=Array.from({length:Math.floor(this.Graphic.height)},((t,e)=>s.slice(e*i,(e+1)*i))),this.needUpdBitmap=!1}checkBitmap(t){return 0!=this.bitmap[Math.floor(t.y)-this.bound[0][1]][Math.floor(t.x)-this.bound[0][0]]}remove(){this.obj.canvas.stage.removeChild(this.boundBox),this.obj.canvas.stage.removeChild(this.Graphic),this.boundBox.destroy(),this.Graphic.destroy(),this.removed=!0}}class v{constructor(t,s,i,e,a){this.canvas=t,this.index=t.pO.length,t.pO.push(this),this.geometry=M(s,i,e,a,this),this.IAA=new f(s,this.geometry.data,this),this.removed=!1,t.IAseq[0][0==s?0:1].push(this.IAA)}update(){this.geometry.calcData(),this.IAA.update()}remove(){this.IAA.remove(),this.removed=!0}toObj(){var t=new X(this.canvas,this.geometry.type,this.geometry.dfnType,this.geometry.dfn,{}).index;return this.remove(),t}}class u extends t{constructor(t,s,i){super(1,0,t,s,i)}init(t){this.seqI=1,this.dfn.p[0].children.push(this),this.dfn.p[1].children.push(this),this.parents=[this.dfn.p[0],this.dfn.p[1]]}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.p[0].data.x,s=this.dfn.p[0].data.y,i=this.dfn.p[1].data.x,e=this.dfn.p[1].data.y;t==i?s==e?this.data.exist=!1:(this.data.exist=!0,this.data.a=0,this.data.b=t,this.data.c=1,this.data.d=0,this.data.r=[s,e],this.cache.p=[s,e],this.data.dr=s<e?1:-1):(this.data.exist=!0,this.data.a=1,this.data.b=0,this.data.c=(s-e)/(t-i),this.data.r=[t,i],this.data.d=s-this.data.c*t,this.cache.p=[t,i],this.data.dr=t<i?1:-1)}}beginDraw(t){this.dfn.p[1].beginDrag(t),this.dfn.p[1].initializing=!0}beginDrag(t){this.beginMove(t),this.focusOnIt()}beginMove(t){this.dfn.p[0].beginMove(t),this.dfn.p[1].beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.p[0].updMove(t),this.dfn.p[1].updMove(t)}preDefine(){for(var t in this.obj.canvas.O)if(!this.obj.canvas.O[t].removed&&this.obj.canvas.O[t].index!=this.obj.index)switch(this.obj.canvas.O[t].geometry.type){case 0:break;case 1:if(c(this.parents,this.obj.canvas.O[t].geometry.parents))continue;this.obj.pObjs.push(new v(this.obj.canvas,0,3,{l:[this,this.obj.canvas.O[t].geometry]},{}));break;case 2:this.obj.pObjs.push(new v(this.obj.canvas,0,6,{l:this,c:this.obj.canvas.O[t].geometry},{})),this.obj.pObjs.push(new v(this.obj.canvas,0,7,{l:this,c:this.obj.canvas.O[t].geometry},{}))}}generateRefCrd(){if(!this.data.exist)return{x:void 0,y:void 0};var t=(this.cache.p[0]+this.cache.p[1])/2;return{x:this.data.a*t+this.data.b,y:this.data.c*t+this.data.d}}}class y extends t{constructor(t,s,i){super(1,1,t,s,i)}init(t){this.seqI=1,this.dfn.p[0].children.push(this),this.dfn.p[1].children.push(this),this.parents=[this.dfn.p[0],this.dfn.p[1]]}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.p[0].data.x,s=this.dfn.p[0].data.y,i=this.dfn.p[1].data.x,e=this.dfn.p[1].data.y;t==i?s==e?this.data.exist=!1:(this.data.exist=!0,this.data.a=0,this.data.b=t,this.data.c=1,this.data.d=0,this.data.r=[-1/0,1/0],this.cache.p=[s,e],this.data.dr=s<e?1:-1):(this.data.exist=!0,this.data.a=1,this.data.b=0,this.data.c=(s-e)/(t-i),this.data.r=[-1/0,1/0],this.data.d=s-this.data.c*t,this.cache.p=[t,i],this.data.dr=t<i?1:-1)}}beginDraw(t){this.dfn.p[1].beginDrag(t),this.dfn.p[1].initializing=!0}beginDrag(t){this.beginMove(t),this.focusOnIt()}beginMove(t){this.dfn.p[0].beginMove(t),this.dfn.p[1].beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.p[0].updMove(t),this.dfn.p[1].updMove(t)}preDefine(){for(var t in this.obj.canvas.O)if(!this.obj.canvas.O[t].removed&&this.obj.canvas.O[t].index!=this.obj.index)switch(this.obj.canvas.O[t].geometry.type){case 0:break;case 1:if(c(this.parents,this.obj.canvas.O[t].geometry.parents))continue;this.obj.pObjs.push(new v(this.obj.canvas,0,3,{l:[this,this.obj.canvas.O[t].geometry]},{}));break;case 2:this.obj.pObjs.push(new v(this.obj.canvas,0,6,{l:this,c:this.obj.canvas.O[t].geometry},{})),this.obj.pObjs.push(new v(this.obj.canvas,0,7,{l:this,c:this.obj.canvas.O[t].geometry},{}))}}generateRefCrd(){if(!this.data.exist)return{x:void 0,y:void 0};var t=(this.cache.p[0]+this.cache.p[1])/2;return{x:this.data.a*t+this.data.b,y:this.data.c*t+this.data.d}}}class m extends t{constructor(t,s,i){super(1,2,t,s,i)}init(t){this.seqI=1,this.dfn.p[0].children.push(this),this.dfn.p[1].children.push(this),this.parents=[this.dfn.p[0],this.dfn.p[1]]}calcData(){if(!this.checkHiddenParents()){this.data.exist=!0;var t=this.dfn.p[0].data.x,s=this.dfn.p[0].data.y,i=this.dfn.p[1].data.x,e=this.dfn.p[1].data.y;t==i?s==e?this.data.exist=!1:(this.data.exist=!0,this.data.a=0,this.data.b=t,this.data.c=1,this.data.d=0,this.cache.p=[s,e],s<e?(this.data.r=[s,1/0],this.data.dr=1):(this.data.r=[-1/0,s],this.data.dr=-1)):(this.data.exist=!0,this.data.a=1,this.data.b=0,this.data.c=(s-e)/(t-i),this.data.d=s-this.data.c*t,this.cache.p=[t,i],t<i?(this.data.r=[t,1/0],this.data.dr=1):(this.data.r=[-1/0,t],this.data.dr=-1))}}beginDraw(t){this.dfn.p[1].beginDrag(t),this.dfn.p[1].initializing=!0}beginDrag(t){this.beginMove(t),this.focusOnIt()}beginMove(t){this.dfn.p[0].beginMove(t),this.dfn.p[1].beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.p[0].updMove(t),this.dfn.p[1].updMove(t)}preDefine(){for(var t in this.obj.canvas.O)if(!this.obj.canvas.O[t].removed&&this.obj.canvas.O[t].index!=this.obj.index)switch(this.obj.canvas.O[t].geometry.type){case 0:break;case 1:if(c(this.parents,this.obj.canvas.O[t].geometry.parents))continue;this.obj.pObjs.push(new v(this.obj.canvas,0,3,{l:[this,this.obj.canvas.O[t].geometry]},{}));break;case 2:this.obj.pObjs.push(new v(this.obj.canvas,0,6,{l:this,c:this.obj.canvas.O[t].geometry},{})),this.obj.pObjs.push(new v(this.obj.canvas,0,7,{l:this,c:this.obj.canvas.O[t].geometry},{}))}}generateRefCrd(){if(!this.data.exist)return{x:void 0,y:void 0};var t=(this.cache.p[0]+this.cache.p[1])/2;return{x:this.data.a*t+this.data.b,y:this.data.c*t+this.data.d}}}class x extends t{constructor(t,s,i){super(1,3,t,s,i)}init(t){this.seqI=1,this.dfn.p.children.push(this),this.dfn.l.children.push(this),this.parents=[this.dfn.p,this.dfn.l],this.calcData()}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.p.data.x,s=this.dfn.p.data.y,i=this.dfn.l.data.a,e=(this.dfn.l.data.b,this.dfn.l.data.c);if(this.dfn.l.data.d,0==e)this.data.exist=!0,this.data.a=0,this.data.b=t,this.data.c=1,this.data.d=0,this.data.dr=-this.dfn.l.data.dr,1==this.data.dr?this.cache.p=[t+10/Math.sqrt(1+a*a),t-10/Math.sqrt(1+a*a)]:this.cache.p=[t-10/Math.sqrt(1+a*a),t+10/Math.sqrt(1+a*a)];else{var a=-i/e;this.data.exist=!0,this.data.a=1,this.data.b=0,this.data.c=a,this.data.d=s-a*t,this.data.dr=a>0?-this.dfn.l.data.dr:this.dfn.l.data.dr,1==this.data.dr?this.cache.p=[t+1/Math.sqrt(1+a*a),t-1/Math.sqrt(1+a*a)]:this.cache.p=[t-1/Math.sqrt(1+a*a),t+1/Math.sqrt(1+a*a)]}this.data.r=[-1/0,1/0]}}beginDrag(t){this.beginMove(t),this.focusOnIt()}beginMove(t){this.dfn.p.beginMove(t),this.dfn.l.beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.p.updMove(t),this.dfn.l.updMove(t)}preDefine(){for(var t in this.obj.canvas.O)if(!this.obj.canvas.O[t].removed&&this.obj.canvas.O[t].index!=this.obj.index)switch(this.obj.canvas.O[t].geometry.type){case 0:break;case 1:if(c(this.parents,this.obj.canvas.O[t].geometry.parents))continue;this.obj.pObjs.push(new v(this.obj.canvas,0,3,{l:[this,this.obj.canvas.O[t].geometry]},{}));break;case 2:this.obj.pObjs.push(new v(this.obj.canvas,0,6,{l:this,c:this.obj.canvas.O[t].geometry},{})),this.obj.pObjs.push(new v(this.obj.canvas,0,7,{l:this,c:this.obj.canvas.O[t].geometry},{}))}}generateRefCrd(){if(!this.data.exist)return{x:void 0,y:void 0};var t=2*(this.cache.p[1]-this.cache.p[0])+this.cache.p[0];return{x:this.data.a*t+this.data.b,y:this.data.c*t+this.data.d}}}class j extends t{constructor(t,s,i){super(1,4,t,s,i)}init(t){this.seqI=1,this.dfn.p.children.push(this),this.dfn.l.children.push(this),this.parents=[this.dfn.p,this.dfn.l],this.calcData()}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.p.data.x,s=this.dfn.p.data.y,i=this.dfn.l.data.a,e=(this.dfn.l.data.b,this.dfn.l.data.c);if(this.dfn.l.data.d,0==i)this.data.exist=!0,this.data.a=0,this.data.b=t,this.data.c=1,this.data.d=0;else{var a=e/i;this.data.exist=!0,this.data.a=1,this.data.b=0,this.data.c=a,this.data.d=s-a*t}this.data.dr=this.dfn.l.data.dr,1==this.data.dr?this.cache.p=[t+1/Math.sqrt(1+a*a),t-1/Math.sqrt(1+a*a)]:this.cache.p=[t-1/Math.sqrt(1+a*a),t+1/Math.sqrt(1+a*a)],this.data.r=[-1/0,1/0]}}beginDrag(t){this.beginMove(t),this.focusOnIt()}beginMove(t){this.dfn.p.beginMove(t),this.dfn.l.beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.p.updMove(t),this.dfn.l.updMove(t)}preDefine(){for(var t in this.obj.canvas.O)if(!this.obj.canvas.O[t].removed&&this.obj.canvas.O[t].index!=this.obj.index)switch(this.obj.canvas.O[t].geometry.type){case 0:break;case 1:if(c(this.parents,this.obj.canvas.O[t].geometry.parents))continue;this.obj.pObjs.push(new v(this.obj.canvas,0,3,{l:[this,this.obj.canvas.O[t].geometry]},{}));break;case 2:this.obj.pObjs.push(new v(this.obj.canvas,0,6,{l:this,c:this.obj.canvas.O[t].geometry},{})),this.obj.pObjs.push(new v(this.obj.canvas,0,7,{l:this,c:this.obj.canvas.O[t].geometry},{}))}}generateRefCrd(){if(!this.data.exist)return{x:void 0,y:void 0};var t=2*(this.cache.p[1]-this.cache.p[0])+this.cache.p[0];return{x:this.data.a*t+this.data.b,y:this.data.c*t+this.data.d}}}class O extends t{constructor(t,s,i){super(1,5,t,s,i)}init(t){this.seqI=1,this.dfn.p[0].children.push(this),this.dfn.p[1].children.push(this),this.parents=[this.dfn.p[0],this.dfn.p[1]]}calcData(){if(!this.checkHiddenParents()){this.data.exist=!0;var t=this.dfn.p[0].data.x,s=this.dfn.p[0].data.y,i=this.dfn.p[1].data.x,e=this.dfn.p[1].data.y;t==i?s==e?this.data.exist=!1:(this.data.exist=!0,this.data.a=0,this.data.b=t,this.data.c=1,this.data.d=0,this.cache.p=[s,e],s<e?(this.data.r=[e,1/0],this.data.dr=1):(this.data.r=[-1/0,e],this.data.dr=-1)):(this.data.exist=!0,this.data.a=1,this.data.b=0,this.data.c=(s-e)/(t-i),this.data.d=s-this.data.c*t,this.cache.p=[t,i],t<i?(this.data.r=[i,1/0],this.data.dr=1):(this.data.r=[-1/0,i],this.data.dr=-1))}}beginDraw(t){this.dfn.p[1].beginDrag(t),this.dfn.p[1].initializing=!0}beginDrag(t){this.beginMove(t),this.focusOnIt()}beginMove(t){this.dfn.p[0].beginMove(t),this.dfn.p[1].beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.p[0].updMove(t),this.dfn.p[1].updMove(t)}preDefine(){for(var t in this.obj.canvas.O)if(!this.obj.canvas.O[t].removed&&this.obj.canvas.O[t].index!=this.obj.index)switch(this.obj.canvas.O[t].geometry.type){case 0:break;case 1:if(c(this.parents,this.obj.canvas.O[t].geometry.parents))continue;this.obj.pObjs.push(new v(this.obj.canvas,0,3,{l:[this,this.obj.canvas.O[t].geometry]},{}));break;case 2:this.obj.pObjs.push(new v(this.obj.canvas,0,6,{l:this,c:this.obj.canvas.O[t].geometry},{})),this.obj.pObjs.push(new v(this.obj.canvas,0,7,{l:this,c:this.obj.canvas.O[t].geometry},{}))}}generateRefCrd(){if(!this.data.exist)return{x:void 0,y:void 0};var t=(this.cache.p[0]+this.cache.p[1])/2;return{x:this.data.a*t+this.data.b,y:this.data.c*t+this.data.d}}}class w extends t{constructor(t,s,i){super(2,0,t,s,i)}init(t){this.seqI=1,this.dfn.p[0].children.push(this),this.dfn.p[1].children.push(this),this.parents=[this.dfn.p[0],this.dfn.p[1]]}calcData(){if(!this.checkHiddenParents()){var t=this.dfn.p[0].data.x,s=this.dfn.p[0].data.y,i=this.dfn.p[1].data.x,e=this.dfn.p[1].data.y;this.data.exist=!0,this.data.x=t,this.data.y=s,this.data.r=Math.sqrt((t-i)*(t-i)+(s-e)*(s-e))}}beginDraw(t){this.dfn.p[1].beginDrag(t),this.dfn.p[1].initializing=!0}beginDrag(t){this.beginMove(t),this.focusOnIt()}beginMove(t){this.dfn.p[0].beginMove(t),this.dfn.p[1].beginMove(t)}updDrag(t){this.updMove(t)}updMove(t){this.dfn.p[0].updMove(t),this.dfn.p[1].updMove(t)}preDefine(){for(var t in this.obj.canvas.O)if(!this.obj.canvas.O[t].removed&&this.obj.canvas.O[t].index!=this.obj.index)switch(this.obj.canvas.O[t].geometry.type){case 0:break;case 1:this.obj.pObjs.push(new v(this.obj.canvas,0,6,{l:this.obj.canvas.O[t].geometry,c:this},{})),this.obj.pObjs.push(new v(this.obj.canvas,0,7,{l:this.obj.canvas.O[t].geometry,c:this},{}));break;case 2:this.obj.pObjs.push(new v(this.obj.canvas,0,4,{c:[this,this.obj.canvas.O[t].geometry]},{})),this.obj.pObjs.push(new v(this.obj.canvas,0,5,{c:[this,this.obj.canvas.O[t].geometry]},{}))}}generateRefCrd(){return this.data.exist?{x:this.data.x+this.data.r/1.4142135623730951,y:this.data.y+this.data.r/1.4142135623730951}:{x:void 0,y:void 0}}}function M(t,d,c,p,l){switch(t){case 0:switch(d){case 0:return new s(c,p,l);case 1:return new i(c,p,l);case 2:return new e(c,p,l);case 3:return new a(c,p,l);case 4:return new h(c,p,l);case 5:return new n(c,p,l);case 6:return new o(c,p,l);case 7:return new r(c,p,l)}break;case 1:switch(d){case 0:return new u(c,p,l);case 1:return new y(c,p,l);case 2:return new m(c,p,l);case 3:return new x(c,p,l);case 4:return new j(c,p,l);case 5:return new O(c,p,l)}break;case 2:switch(d){case 0:return new w(c,p,l)}}}const I=[{p:{radius:5,color:1402304,alpha:1,ol:{width:1,color:0,alpha:1,cap:PIXI.LINE_CAP.ROUND},margin:{radius:0,color:16711680,alpha:.2}},l:{body:{width:2.5,color:8092539,alpha:1,cap:PIXI.LINE_CAP.ROUND},margin:{width:0,color:0,alpha:.2,cap:PIXI.LINE_CAP.ROUND}}},{p:{radius:5,color:1402304,alpha:1,ol:{width:1,color:0,alpha:1,cap:PIXI.LINE_CAP.ROUND},margin:{radius:10,color:16711680,alpha:.2}},l:{body:{width:2.5,color:8092539,alpha:1,cap:PIXI.LINE_CAP.ROUND},margin:{width:7,color:14671839,alpha:1,cap:PIXI.LINE_CAP.ROUND}}}];class D{constructor(t,s,i){this.type=t,this.data=s,this.obj=i,this.styleMode=0,this.Graphic=new PIXI.Graphics,this.hidden=!1,this.removed=!1,this.Graphic.zIndex=i.canvas.zIofT[this.type],i.canvas.stage.addChild(this.Graphic),this.update()}update(){if(this.Graphic.clear(),!this.hidden&&this.data.exist)switch(this.type){case 0:this.Graphic.beginFill(I[this.styleMode].p.margin.color,I[this.styleMode].p.margin.alpha),this.Graphic.drawCircle(...this.obj.canvas.tran(this.data),I[this.styleMode].p.margin.radius),this.Graphic.beginFill(I[this.styleMode].p.color,I[this.styleMode].p.alpha),this.Graphic.lineStyle(I[this.styleMode].p.ol),this.Graphic.drawCircle(...this.obj.canvas.tran(this.data),I[this.styleMode].p.radius);break;case 1:var t=d(this.data,[this.obj.canvas.revTran(this.obj.canvas.stageBound[0]),this.obj.canvas.revTran(this.obj.canvas.stageBound[1])]);if(!t[0])return;this.Graphic.lineStyle(I[this.styleMode].l.margin),this.Graphic.moveTo(...this.obj.canvas.tran(t[1])),this.Graphic.lineTo(...this.obj.canvas.tran(t[2])),this.Graphic.lineStyle(I[this.styleMode].l.body),this.Graphic.moveTo(...this.obj.canvas.tran(t[1])),this.Graphic.lineTo(...this.obj.canvas.tran(t[2]));break;case 2:this.Graphic.lineStyle(I[this.styleMode].l.margin),this.Graphic.drawCircle(...this.obj.canvas.tran(this.data),this.data.r*this.obj.canvas.tr[0]),this.Graphic.lineStyle(I[this.styleMode].l.body),this.Graphic.drawCircle(...this.obj.canvas.tran(this.data),this.data.r*this.obj.canvas.tr[0])}}changeStyleMode(t){this.styleMode=t,this.update()}remove(){this.obj.canvas.stage.removeChild(this.Graphic),this.Graphic.destroy(),this.removed=!0}}class k{constructor(t,s,i){this.crd=t,this.offset={x:5,y:-25},this.content=s,this.obj=i,this.element=document.createElement("div"),this.element.style.position="absolute",this.element.classList.add("graphic-tagbox"),i.canvas.PIXIapp.resizeTo.appendChild(this.element),this.update(),this.updateContent(),this.element.children[0].classList.add("graphic-tag"),this.element.children[0].onmousedown=t=>{this.element.children[0].setAttribute("dragging",""),0==this.obj.canvas.mode&&(this.obj.canvas.Status=3,this.obj.canvas.F=this.obj.index,this.dragPos=[t.clientX,t.clientY],this.dragBeginOffset={x:this.offset.x,y:this.offset.y})},this.element.children[0].onmouseup=()=>{this.element.children[0].removeAttribute("dragging"),this.obj.canvas.Status=0}}update(){var t=this.obj.canvas.tran(this.crd,!0);this.element.style.left=t.x+this.offset.x+"px",this.element.style.top=t.y+this.offset.y+"px"}updateContent(){katex.render(this.content,this.element,{})}remove(){this.element.remove()}}class X{constructor(t,s,i,e,a){this.canvas=t,this.index=t.O.length,t.O.push(this),this.geometry=M(s,i,e,a,this),this.IAA=new f(s,this.geometry.data,this),this.GFD=new D(s,this.geometry.data,this),this.removed=!1,this.pObjs=[],t.IAseq[1][0==s?0:1].push(this.IAA),0==s&&0==i&&this.canvas.rootObjs.push(this),this.name=function(t,s){switch(t){case 0:var i="ABCDEFGHIJKLMNOPQRSTUVWXYZ"[s%26],e=parseInt(s/26);return e>0?i+"_{"+e+"}":i;case 1:return"l_{"+(s+1)+"}";case 2:return"c_{"+(s+1)+"}"}}(s,t.nextNameI[s]),t.nextNameI[s]++,t.names.push(this.name),this.refCrd=this.geometry.generateRefCrd(),this.tag=new k(this.refCrd,this.name,this),this.geometry.preDefine()}update(){this.geometry.calcData(),this.GFD.update(),this.IAA.update();var t=this.geometry.generateRefCrd();for(var s in this.refCrd.x=t.x,this.refCrd.y=t.y,this.tag.update(),this.geometry.children)this.geometry.children[s].obj.update();for(var s in this.pObjs)this.pObjs[s].removed||this.pObjs[s].update()}remove(){for(var t in this.canvas.F=-1,this.canvas.Status=0,this.IAA.remove(),this.GFD.remove(),this.tag.remove(),this.removed=!0,this.geometry.children)this.geometry.children[t].obj.remove()}}class P{constructor(t,s,i,e,a){this.canvas=t,this.mode=s,this.iconSrc=e,this.title=i,this.div=a,this.element=document.createElement("input"),this.element.setAttribute("type","radio"),this.element.setAttribute("name","tool"),this.element.setAttribute("class","mode-switch"),this.element.setAttribute("title",this.title),this.element.style.backgroundImage=`url("${this.iconSrc}")`,this.element.onclick=()=>{this.canvas.changeMode(this.mode)}}activate(){this.div.appendChild(this.element)}}PIXI.settings.SORTABLE_CHILDREN=!0;var A=new class{PIXIappSetting={antialias:!0,resolution:window.devicePixelRatio||1,autoDensity:!0,backgroundAlpha:0,resizeTo:document.querySelector("#workarea-container"),view:document.querySelector("#workarea"),backgroundColor:0,backgroundAlpha:0};zIofT=[10,5,5];constructor(){this.PIXIapp=new PIXI.Application(this.PIXIappSetting),this.stage=this.PIXIapp.stage,this.O=[],this.pO=[],this.IAseq=[[[],[]],[[],[]]],this.Status=0,this.chooseObjs=[],this.F=-1,this.mode=1,this.showBoundBox=!1,this.stageBound=[[0,0],[this.PIXIapp.view.offsetWidth-p(this.PIXIapp.view),this.PIXIapp.view.offsetHeight-l(this.PIXIapp.view)]],this.tr=[50,400,400],this.rootObjs=[],this.dragOffset={x:0,y:0},this.names=[],this.nextNameI=[0,0,0],this.axisXtype=2,this.axisYtype=2,this.axisStyle={width:1,color:0,alpha:1,cap:PIXI.LINE_CAP.ROUND},this.Xscale=[],this.Yscale=[],this.scaleFont=new PIXI.TextStyle({fontFamily:"cambria",fontSize:12}),this.axis=new PIXI.Graphics,this.stage.addChild(this.axis),this.updAxes(),this.PIXIapp.renderer.plugins.interaction.on("pointerdown",(t=>{let s=this.revTran({x:t.data.global.x,y:t.data.global.y},!0);var i=this.chooseByGlobalPos({x:t.data.global.x,y:t.data.global.y});switch(this.mode){case 0:-1!=i?this.O[i].geometry.beginDrag(s):(this.dragOffset.x=this.tr[1]-t.data.global.x,this.dragOffset.y=this.tr[2]-t.data.global.y,this.Status=2);break;case 1:if(-1==i)new X(this,1,0,{p:[new X(this,0,0,{},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});else switch(this.O[i].geometry.type){case 0:new X(this,1,0,{p:[this.O[i].geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 1:new X(this,1,0,{p:[new X(this,0,1,{l:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 2:new X(this,1,0,{p:[new X(this,0,2,{c:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{})}this.O[this.O.length-1].geometry.beginDraw(s);break;case 2:if(-1==i)new X(this,0,0,{},{pos:s});else switch(this.O[i].geometry.type){case 0:break;case 1:new X(this,0,1,{l:this.O[i].geometry},{pos:s});break;case 2:new X(this,0,2,{c:this.O[i].geometry},{pos:s})}break;case 3:if(-1==i)new X(this,2,0,{p:[new X(this,0,0,{},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});else switch(this.O[i].geometry.type){case 0:new X(this,2,0,{p:[this.O[i].geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 1:new X(this,2,0,{p:[new X(this,0,1,{l:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 2:new X(this,2,0,{p:[new X(this,0,2,{c:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{})}this.O[this.O.length-1].geometry.beginDraw(s);break;case 4:if(-1==i)new X(this,1,1,{p:[new X(this,0,0,{},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});else switch(this.O[i].geometry.type){case 0:new X(this,1,1,{p:[this.O[i].geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 1:new X(this,1,1,{p:[new X(this,0,1,{l:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 2:new X(this,1,1,{p:[new X(this,0,2,{c:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{})}this.O[this.O.length-1].geometry.beginDraw(s);break;case 5:if(-1==i)new X(this,1,2,{p:[new X(this,0,0,{},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});else switch(this.O[i].geometry.type){case 0:new X(this,1,2,{p:[this.O[i].geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 1:new X(this,1,2,{p:[new X(this,0,1,{l:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 2:new X(this,1,2,{p:[new X(this,0,2,{c:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{})}this.O[this.O.length-1].geometry.beginDraw(s);break;case 6:case 7:case 8:-1==i?this.clearChooseList():(this.chooseObjs.push(this.O[i]),this.processFn());break;case 9:if(-1==i)new X(this,1,5,{p:[new X(this,0,0,{},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});else switch(this.O[i].geometry.type){case 0:new X(this,1,5,{p:[this.O[i].geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 1:new X(this,1,5,{p:[new X(this,0,1,{l:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{});break;case 2:new X(this,1,5,{p:[new X(this,0,2,{c:this.O[i].geometry},{pos:s}).geometry,new X(this,0,0,{},{pos:s}).geometry]},{})}this.O[this.O.length-1].geometry.beginDraw(s)}})),this.PIXIapp.renderer.plugins.interaction.on("pointermove",(t=>{let s=this.revTran({x:t.data.global.x,y:t.data.global.y},!0);switch(this.Status){case 0:break;case 1:this.O[this.F].geometry.updDrag(s);break;case 2:this.tr[1]=t.data.global.x+this.dragOffset.x,this.tr[2]=t.data.global.y+this.dragOffset.y,this.updAll();break;case 3:this.O[this.F].tag.offset.x=t.data.global.x+p(this.PIXIapp.resizeTo)-this.O[this.F].tag.dragPos[0]+this.O[this.F].tag.dragBeginOffset.x,this.O[this.F].tag.offset.y=t.data.global.y+l(this.PIXIapp.resizeTo)-this.O[this.F].tag.dragPos[1]+this.O[this.F].tag.dragBeginOffset.y,this.O[this.F].tag.update()}})),this.PIXIapp.renderer.plugins.interaction.on("pointerup",(t=>{let s=this.revTran({x:t.data.global.x,y:t.data.global.y},!0);if(-1!=this.F&&this.O[this.F].geometry.initializing){this.O[this.F].geometry.initializing=!1;var i=this.chooseByGlobalPos({x:t.data.global.x,y:t.data.global.y});if(-1!=i)switch(this.O[i].geometry.type){case 0:var e=this.O[i].geometry;e.children.push(this.O[this.F].geometry.children[0]),this.O[this.F].geometry.children[0].parents.pop(),this.O[this.F].geometry.children[0].parents.push(e),this.O[this.F].geometry.children[0].dfn.p[1]=e,this.O[this.F].geometry.children.pop(),this.O[this.F].remove();break;case 1:this.O[this.F].geometry.define(0,1,{l:this.O[i].geometry},{pos:s});break;case 2:this.O[this.F].geometry.define(0,2,{c:this.O[i].geometry},{pos:s})}}var a=this.IAseq.flat(1/0);for(var h in a)a[h].removed||(a[h].needUpdBound&&(a[h].updBound(),a[h].needUpdBound=!1),a[h].needUpdBitmap&&(a[h].updBitmap(),a[h].needUpdBitmap=!1));this.F=-1,this.Status=0})),this.PIXIapp.view.onwheel=t=>{t.wheelDelta>0?(this.tr[0]*=1.1,this.tr[1]=t.offsetX+1.1*(this.tr[1]-t.offsetX),this.tr[2]=t.offsetY+1.1*(this.tr[2]-t.offsetY)):(this.tr[0]/=1.1,this.tr[1]=t.offsetX+(this.tr[1]-t.offsetX)/1.1,this.tr[2]=t.offsetY+(this.tr[2]-t.offsetY)/1.1),this.updAll()}}tran(t,s=!1){return void 0!==t[0]&&(t={x:t[0],y:t[1]}),s?{x:t.x*this.tr[0]+this.tr[1],y:-t.y*this.tr[0]+this.tr[2]}:[t.x*this.tr[0]+this.tr[1],-t.y*this.tr[0]+this.tr[2]]}revTran(t,s=!1){return void 0!==t[0]&&(t={x:t[0],y:t[1]}),s?{x:(t.x-this.tr[1])/this.tr[0],y:-(t.y-this.tr[2])/this.tr[0]}:[(t.x-this.tr[1])/this.tr[0],-(t.y-this.tr[2])/this.tr[0]]}updAll(){for(var t in this.updAxes(),this.rootObjs)this.rootObjs[t].removed||this.rootObjs[t].update()}chooseByGlobalPos(t){if(0!=this.mode){var s=this.IAseq[0].flat(1/0);for(var i in s)if(!s[i].removed&&s[i].bound[0][0]<=t.x&&t.x<=s[i].bound[1][0]&&s[i].bound[0][1]<=t.y&&t.y<=s[i].bound[1][1]&&s[i].checkBitmap(t))return s[i].obj.toObj()}var e=this.IAseq[1].flat(1/0);for(var i in e)if(!e[i].removed&&e[i].bound[0][0]<=t.x&&t.x<=e[i].bound[1][0]&&e[i].bound[0][1]<=t.y&&t.y<=e[i].bound[1][1]&&e[i].checkBitmap(t))return e[i].obj.index;return-1}clearChooseList(){for(var t in this.chooseObjs)this.chooseObjs[t].GFD.changeStyleMode(0);this.chooseObjs.length=0}changeMode(t){switch(this.mode=t,this.clearChooseList(),this.mode){case 0:case 1:case 2:case 3:case 4:case 5:break;case 6:this.processFn=()=>{switch(this.chooseObjs.length){case 0:break;case 1:0==this.chooseObjs[0].geometry.type?(console.log("not supported"),this.chooseObjs.pop()):this.chooseObjs[0].GFD.changeStyleMode(1);break;case 2:if(0==this.chooseObjs[1].geometry.type)console.log("not supported"),this.chooseObjs.pop();else{switch(this.chooseObjs[0].geometry.type){case 1:switch(this.chooseObjs[1].geometry.type){case 1:new X(this,0,3,{l:[this.chooseObjs[0].geometry,this.chooseObjs[1].geometry]},{});break;case 2:new X(this,0,6,{l:this.chooseObjs[0].geometry,c:this.chooseObjs[1].geometry},{}),new X(this,0,7,{l:this.chooseObjs[0].geometry,c:this.chooseObjs[1].geometry},{})}break;case 2:switch(this.chooseObjs[1].geometry.type){case 1:new X(this,0,6,{l:this.chooseObjs[1].geometry,c:this.chooseObjs[0].geometry},{}),new X(this,0,7,{l:this.chooseObjs[1].geometry,c:this.chooseObjs[0].geometry},{});break;case 2:new X(this,0,4,{c:[this.chooseObjs[0].geometry,this.chooseObjs[1].geometry]},{}),new X(this,0,5,{c:[this.chooseObjs[0].geometry,this.chooseObjs[1].geometry]},{})}}this.clearChooseList()}}};break;case 7:this.processFn=()=>{switch(this.chooseObjs.length){case 0:break;case 1:2==this.chooseObjs[0].geometry.type?(console.log("not supported"),this.chooseObjs.pop()):this.chooseObjs[0].GFD.changeStyleMode(1);break;case 2:if(2==this.chooseObjs[1].geometry.type)console.log("not supported"),this.chooseObjs.pop();else{switch(this.chooseObjs[0].geometry.type){case 0:switch(this.chooseObjs[1].geometry.type){case 0:console.log("not supported"),this.chooseObjs.pop();break;case 1:new X(this,1,3,{p:this.chooseObjs[0].geometry,l:this.chooseObjs[1].geometry},{})}break;case 1:switch(this.chooseObjs[1].geometry.type){case 0:new X(this,1,3,{p:this.chooseObjs[1].geometry,l:this.chooseObjs[0].geometry},{});break;case 1:console.log("not supported"),this.chooseObjs.pop()}}this.clearChooseList()}}};break;case 8:this.processFn=()=>{switch(this.chooseObjs.length){case 0:break;case 1:2==this.chooseObjs[0].geometry.type?(console.log("not supported"),this.chooseObjs.pop()):this.chooseObjs[0].GFD.changeStyleMode(1);break;case 2:if(2==this.chooseObjs[1].geometry.type)console.log("not supported"),this.chooseObjs.pop();else{switch(this.chooseObjs[0].geometry.type){case 0:switch(this.chooseObjs[1].geometry.type){case 0:console.log("not supported"),this.chooseObjs.pop();break;case 1:new X(this,1,4,{p:this.chooseObjs[0].geometry,l:this.chooseObjs[1].geometry},{})}break;case 1:switch(this.chooseObjs[1].geometry.type){case 0:new X(this,1,4,{p:this.chooseObjs[1].geometry,l:this.chooseObjs[0].geometry},{});break;case 1:console.log("not supported"),this.chooseObjs.pop()}}this.clearChooseList()}}}}}updAxes(){this.axis.clear();var t=this.tran([0,0],!0),s=this.stageBound[0][0],i=this.stageBound[0][1],e=this.stageBound[1][0],a=this.stageBound[1][1],h=this.revTran(this.stageBound[0],!0),n=this.revTran(this.stageBound[1],!0);this.axis.lineStyle(this.axisStyle);for(var o=1,r=new PIXI.Text("1",this.scaleFont);this.tr[0]*o<1.5*(r.width+10);)"2"==(o+"")[0]?(o/=2,o*=5):o*=2,r.text=o+"";for(;this.tr[0]*o>5*(r.width+10);)"5"==(o+"")[(o+"").length-1]?(o*=2,o/=5):o/=2,r.text=o+"";if(0!=this.axisXtype){if(t.y<i||t.y>a);else if(this.axis.moveTo(s,t.y),this.axis.lineTo(e,t.y),this.axis.lineTo(e-8,t.y-5),this.axis.moveTo(e,t.y),this.axis.lineTo(e-8,t.y+5),this.axisXtype>1)for(let s=g(Math.ceil(h.x/o),o);s<=g(Math.floor(n.x/o),o);s=b(s,o))if(0!=s){var d=this.tran([s,0]);this.axis.moveTo(...d),this.axis.lineTo(d[0],t.y+3)}if(this.axisXtype>1){for(let t in this.Xscale)this.Xscale[t].text="";for(let s=g(Math.ceil(h.x/o),o),e=1;s<=g(Math.floor(n.x/o),o);s=b(s,o))0!=s&&(d=this.tran([s,0]),void 0===this.Xscale[e]&&(this.Xscale[e]=new PIXI.Text("",this.scaleFont),this.stage.addChild(this.Xscale[e])),this.Xscale[e].text=s+"",this.Xscale[e].x=d[0]-this.Xscale[e].width/2,this.Xscale[e].y=t.y+2,this.Xscale[e].y<i&&(this.Xscale[e].y=i),this.Xscale[e].y>a-this.Xscale[e].height&&(this.Xscale[e].y=a-this.Xscale[e].height),e++)}}if(0!=this.axisYtype){if(t.x<s||t.x>e);else if(this.axis.moveTo(t.x,a),this.axis.lineTo(t.x,i),this.axis.lineTo(t.x-5,i+8),this.axis.moveTo(t.x,i),this.axis.lineTo(t.x+5,i+8),this.axisYtype>1)for(let s=g(Math.ceil(n.y/o),o);s<=g(Math.floor(h.y/o),o);s=b(s,o))0!=s&&(d=this.tran([0,s]),this.axis.moveTo(...d),this.axis.lineTo(t.x-3,d[1]));if(this.axisYtype>1){for(let t in this.Yscale)this.Yscale[t].text="";for(let i=g(Math.ceil(n.y/o),o),a=0;i<=g(Math.floor(h.y/o),o);i=b(i,o))0!=i&&(d=this.tran([0,i]),void 0===this.Yscale[a]&&(this.Yscale[a]=new PIXI.Text("",this.scaleFont),this.stage.addChild(this.Yscale[a])),this.Yscale[a].text=i+"",this.Yscale[a].x=t.x-this.Yscale[a].width-4,this.Yscale[a].y=d[1]-this.Yscale[a].height/2,this.Yscale[a].x<s&&(this.Yscale[a].x=s),this.Yscale[a].x>e-this.Yscale[a].width&&(this.Yscale[a].x=e-this.Yscale[a].width),a++)}}(this.axisXtype>1||this.axisYtype>1)&&(void 0===this.Xscale[0]&&(this.Xscale[0]=new PIXI.Text("",this.scaleFont),this.stage.addChild(this.Xscale[0])),this.Xscale[0].text="0",this.Xscale[0].x=t.x-this.Xscale[0].width-2,this.Xscale[0].y=t.y,(this.Xscale[0].x<s||this.Xscale[0].x>e||this.Xscale[0].y<i||this.Xscale[0].y>a)&&(this.Xscale[0].text=""))}};const C=document.getElementById("toolbar"),G=t=>"../assets/"+t;var B=[new P(A,0,"移动",G("move.svg"),C),new P(A,1,"线段",G("segment.svg"),C),new P(A,2,"画点",G("point.svg"),C),new P(A,3,"画圆",G("circle.svg"),C),new P(A,4,"直线",G("line.svg"),C),new P(A,5,"射线",G("halfline.svg"),C),new P(A,6,"交点",G("intersection.svg"),C),new P(A,7,"垂线",G("perpendicular.svg"),C),new P(A,8,"平行线",G("parallel.svg"),C),new P(A,9,"延长线",G("extensionLine.svg"),C),new P(A,10,"角平分线",G("angleBisector.svg"),C),new P(A,11,"切线",G("tangent.svg"),C),new P(A,12,"中垂线",G("perpendicularBisector.svg"),C),new P(A,13,"中点",G("midPoint.svg"),C),new P(A,14,"外接圆",G("circumcircle.svg"),C)];for(let t in B)B[t].activate();B[1].element.setAttribute("checked","")})();